FROM php:8.2-apache

# 添加 Apache 配置，强制传递 Authorization 头给 PHP
RUN echo 'SetEnvIf Authorization "(.*)" HTTP_AUTHORIZATION=$1' > /etc/apache2/conf-available/auth-header.conf && \
    a2enconf auth-header && \
    a2enmod rewrite

RUN mkdir -p /var/www/password_cache && \
    chown -R www-data:www-data /var/www/password_cache && \
    chmod -R 0700 /var/www/password_cache

# 复制项目文件
COPY index.php /var/www/html/
COPY passwords.txt /var/www/html/

# 设置权限
RUN chown -R www-data:www-data /var/www/html && \
    chmod 644 /var/www/html/index.php && \
    chmod 444 /var/www/html/passwords.txt

EXPOSE 80
CMD ["apache2-foreground"]
