# 基础镜像：轻量Nginx
FROM nginx:alpine

# 安装依赖
RUN apk add --no-cache bash zip

# 创建工作目录
WORKDIR /app

# 复制压缩包生成脚本到容器
COPY generate_zip.sh /app/
RUN chmod +x /app/generate_zip.sh

# 覆盖Nginx默认配置
RUN echo 'server { \
    listen 80; \
    server_name localhost; \
    root /usr/share/nginx/html; \
    autoindex off; \
    location /www.zip { \
        add_header Content-Type application/zip; \
        add_header Content-Disposition "attachment; filename=www.zip"; \
    } \
}' > /etc/nginx/conf.d/default.conf

# 启动脚本：先生成压缩包，再启动Nginx
CMD ["/bin/bash", "-c", "/app/generate_zip.sh && nginx -g 'daemon off;'"]